# Vibe Scan

[![Vibe Score](https://img.shields.io/badge/vibe--scan-enabled-brightgreen)](https://github.com/brianmeyer/vibe-scan)

A GitHub App that analyzes pull requests for "vibe-coded" production risks. Combines static analysis with LLM-powered review to catch scaling issues, concurrency problems, and other patterns that commonly cause production failures in AI-generated or prototype code.

Now with repo-level `.vibescan.yml` configuration support!

## What is "Vibe-Coded"?

"Vibe-coded" refers to code that:
- Was written quickly as a prototype or generated by AI without careful review
- Relies on happy-path scenarios without defensive coding
- Missing validation, error handling, or proper observability
- Has scaling blind spots (unbounded queries, N+1 patterns, no caching)

## Features

### Static Analysis
Detects production-risk patterns in TypeScript/JavaScript code:

| Category | Examples |
|----------|----------|
| **Scaling** | Unbounded queries, N+1 patterns, missing pagination, looped I/O |
| **Concurrency** | Race conditions, retry storms, shared file writes |
| **Error Handling** | Silent errors, missing try/catch on I/O, async misuse |
| **Data Integrity** | Unvalidated input, type assertions on external data |
| **Code Quality** | TODO/FIXME/HACK comments, console.log debugging |

### LLM Analysis (Advisory)
Uses Groq API to provide additional context on:
- **Scaling Risk** - Performance/cost issues as traffic grows
- **Concurrency Risk** - Race conditions and contention
- **Environment Assumption** - Hidden infrastructure assumptions
- **Data Contract Risk** - Data shape/validation issues
- **Observability Gap** - Missing logging/metrics
- **Resilience Gap** - Missing fault tolerance

### Vibe Score
A 0-100 score indicating production readiness:
- **90-100**: Excellent - Production ready
- **75-89**: Good - Minor concerns
- **60-74**: Moderate risk - Should review before production
- **40-59**: Risky - Significant issues to address
- **0-39**: Critical risk - Major concerns

## Configuration

Create a `.vibescan.yml` in your repository root:

```yaml
version: 1

rules:
  UNBOUNDED_QUERY:
    enabled: true
    level: error
  CONSOLE_DEBUG:
    enabled: false

files:
  ignore:
    - "tests/**"
    - "**/*.spec.ts"
  prototype_zone:
    - "playground/**"
    - "experiments/**"

scoring:
  high_risk_vibe_score: 60
  weight_multiplier: 1.0

overrides:
  - patterns:
      - "src/infra/**"
    rules:
      NO_CACHING:
        level: error
```

### Inline Suppressions

Suppress findings with comments:

```typescript
/* vibescan-ignore-file ALL */

// vibescan-ignore-next-line UNBOUNDED_QUERY
const users = await db.users.findMany();

const data = await fetch("/api"); // vibescan-ignore-line UNSAFE_IO
```

## Installation

### As a GitHub App

1. Create a new GitHub App with these permissions:
   - **Pull requests**: Read & Write
   - **Checks**: Read & Write
   - **Contents**: Read

2. Subscribe to the `pull_request` webhook event

3. Set environment variables:
   ```bash
   GITHUB_APP_ID=your_app_id
   GITHUB_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----\n..."
   GITHUB_WEBHOOK_SECRET=your_webhook_secret
   GROQ_API_KEY=your_groq_api_key  # Optional, for LLM analysis
   ```

4. Deploy and configure the webhook URL

### Local Development

```bash
# Install dependencies
npm install

# Start development server
npm run dev

# Build for production
npm run build
npm run start
```

## How It Works

1. **PR Opened/Updated**: GitHub sends a webhook
2. **Fetch PR Files**: Get the diff patches for changed files
3. **Static Analysis**: Scan patches for known risk patterns
4. **LLM Analysis** (optional): Send high-risk files to Groq for deeper review
5. **Compute Vibe Score**: Calculate production readiness score
6. **Post Results**: Create a check run with findings summary
7. **High-Risk Comment**: Optionally post a PR comment for critical issues

## Project Structure

```
src/
├── server.ts          # Express webhook server
├── github.ts          # GitHub API integration
├── analyzer.ts        # Static analysis engine
├── llm.ts             # LLM integration (Groq)
├── scoring.ts         # Vibe Score computation
├── config/            # Configuration loading
│   ├── schema.ts
│   └── loadConfig.ts
└── core/              # Core types and utilities
    ├── rules.ts
    └── suppression.ts
```

## License

ISC
